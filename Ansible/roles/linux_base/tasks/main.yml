---
# Common Linux hardening -- applies to ALL Linux hosts (Debian + RHEL)

- name: Gather facts
  tags: always
  setup:

- name: Load OS-specific variables
  tags: always
  include_vars: "{{ ansible_os_family }}.yml"

# --- SSH Hardening ---
- name: Harden SSH configuration
  tags: [hardening, ssh]
  include_tasks: ssh_hardening.yml

# --- User Account Security ---
- name: Secure user accounts
  tags: [hardening, users]
  include_tasks: user_security.yml

# --- Remove Unnecessary Services ---
- name: Disable unnecessary services
  tags: [hardening, services]
  include_tasks: disable_services.yml

# --- Kernel Hardening (sysctl) ---
- name: Apply kernel hardening parameters
  tags: [hardening, kernel]
  include_tasks: sysctl_hardening.yml

# --- Audit Logging ---
- name: Configure audit logging
  tags: [hardening, audit]
  include_tasks: audit_logging.yml

# --- SSH Key Distribution ---
- name: Distribute Ansible SSH keys
  tags: [setup, ssh]
  include_tasks: ssh_keys.yml
  when: ansible_ssh_public_key_file is defined
